#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit checks..."

# Run lint-staged
npx lint-staged

# Run type check on changed TypeScript files
if git diff --cached --name-only | grep -E '\.(ts|tsx)$' > /dev/null; then
  echo "🔍 Type checking..."
  npm run type-check:all
fi

# Run unit tests for changed files
if git diff --cached --name-only | grep -E '\.(ts|tsx|js|jsx)$' > /dev/null; then
  echo "🧪 Running tests for changed files..."

  # Run backend tests if backend files changed
  if git diff --cached --name-only | grep -E '^(api-gateway|pms-backend|pms-core|monitoring)/' > /dev/null; then
    npm run test:backend
  fi

  # Run frontend tests if frontend files changed
  if git diff --cached --name-only | grep -E '^(pms-admin|pms-guest|pms-staff|pms-marketplace)/' > /dev/null; then
    npm run test:frontend
  fi
fi

echo "✅ Pre-commit checks passed!"