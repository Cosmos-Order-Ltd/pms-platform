<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMS Platform - Deployment Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin: 0;
        }

        .map-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            min-width: 200px;
        }

        .legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #666;
        }

        #network {
            width: 100%;
            height: 800px;
            background: #fafafa;
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            transform: scale(1.1);
        }

        .node-circle {
            stroke-width: 2;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }

        .node-text {
            font-size: 11px;
            font-weight: 500;
            text-anchor: middle;
            pointer-events: none;
            fill: #333;
        }

        .link {
            stroke: #999;
            stroke-opacity: 0.3;
            stroke-width: 1;
        }

        .link-active {
            stroke: #4CAF50;
            stroke-opacity: 0.8;
            stroke-width: 2;
        }

        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip h3 {
            margin: 0 0 8px 0;
            color: #4CAF50;
        }

        .tooltip .detail {
            margin: 4px 0;
        }

        .status-online {
            color: #4CAF50;
        }

        .status-offline {
            color: #f44336;
        }

        .node-highlight {
            stroke: #ff9800 !important;
            stroke-width: 3 !important;
        }

        .infrastructure-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .infrastructure-info h4 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }

        .info-label {
            font-weight: 500;
            color: #666;
        }

        .info-value {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè® PMS Platform Deployment Map</h1>
        <p>Complete Enterprise Infrastructure - 33 Container Ecosystem on CT101 (192.168.30.98)</p>
    </div>

    <div class="map-container">
        <div class="controls">
            <input type="text" class="search-box" placeholder="Search services..." id="searchBox">

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #4CAF50;"></div>
                    <span>PMS Apps</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196F3;"></div>
                    <span>Databases</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF9800;"></div>
                    <span>Monitoring</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9C27B0;"></div>
                    <span>CI/CD</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #F44336;"></div>
                    <span>Load Balancing</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #607D8B;"></div>
                    <span>Infrastructure</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #795548;"></div>
                    <span>Cyprus Services</span>
                </div>
            </div>

            <div class="stats">
                <div><strong>Total Services:</strong> <span id="totalServices">33</span></div>
                <div><strong>Online:</strong> <span id="onlineServices" class="status-online">33</span></div>
                <div><strong>RAM Usage:</strong> <span>96GB / 100GB</span></div>
            </div>
        </div>

        <svg id="network"></svg>

        <div class="infrastructure-info">
            <h4>üìä Infrastructure Details</h4>
            <div class="info-row">
                <span class="info-label">Container:</span>
                <span class="info-value">CT101 LXC</span>
            </div>
            <div class="info-row">
                <span class="info-label">IP Address:</span>
                <span class="info-value">192.168.30.98</span>
            </div>
            <div class="info-row">
                <span class="info-label">RAM:</span>
                <span class="info-value">100GB</span>
            </div>
            <div class="info-row">
                <span class="info-label">Host:</span>
                <span class="info-value">Proxmox VE</span>
            </div>
            <div class="info-row">
                <span class="info-label">Status:</span>
                <span class="info-value status-online">100% Operational</span>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Service data extracted from deployment configuration
        const services = [
            // PMS Applications
            {
                id: "pms-admin",
                name: "PMS Admin",
                category: "pms",
                port: 3010,
                url: "http://admin.pms.local",
                description: "Property management dashboard",
                status: "online",
                technology: "Next.js 15 + TypeScript",
                connections: ["pms-backend", "postgresql", "redis"]
            },
            {
                id: "pms-guest",
                name: "Guest Portal",
                category: "pms",
                port: 3011,
                url: "http://guest.pms.local",
                description: "Guest booking and services",
                status: "online",
                technology: "Next.js 15 + TypeScript",
                connections: ["pms-backend", "postgresql", "redis"]
            },
            {
                id: "pms-staff",
                name: "Staff Mobile",
                category: "pms",
                port: 3012,
                url: "http://staff.pms.local",
                description: "Staff task management",
                status: "online",
                technology: "Next.js 15 PWA",
                connections: ["pms-backend", "postgresql", "redis"]
            },
            {
                id: "pms-marketplace",
                name: "Marketplace",
                category: "pms",
                port: 3013,
                url: "http://market.pms.local",
                description: "Property sales and rentals",
                status: "online",
                technology: "Next.js 15 + TypeScript",
                connections: ["pms-backend", "postgresql", "mongodb"]
            },
            {
                id: "pms-backend",
                name: "Backend API",
                category: "pms",
                port: 5000,
                url: "http://api.pms.local",
                description: "Core business logic",
                status: "online",
                technology: "Express + TypeScript",
                connections: ["postgresql", "redis", "elasticsearch", "mongodb", "rabbitmq"]
            },

            // Database Cluster
            {
                id: "postgresql",
                name: "PostgreSQL",
                category: "database",
                port: 5432,
                url: "postgresql://192.168.30.98:5432",
                description: "Primary database",
                status: "online",
                technology: "PostgreSQL 15",
                connections: []
            },
            {
                id: "redis",
                name: "Redis",
                category: "database",
                port: 6379,
                url: "redis://192.168.30.98:6379",
                description: "Caching and sessions",
                status: "online",
                technology: "Redis 7",
                connections: []
            },
            {
                id: "elasticsearch",
                name: "Elasticsearch",
                category: "database",
                port: 9200,
                url: "http://192.168.30.98:9200",
                description: "Search and analytics",
                status: "online",
                technology: "Elasticsearch 8",
                connections: []
            },
            {
                id: "mongodb",
                name: "MongoDB",
                category: "database",
                port: 27017,
                url: "mongodb://192.168.30.98:27017",
                description: "Document storage",
                status: "online",
                technology: "MongoDB 6",
                connections: []
            },

            // Load Balancing
            {
                id: "traefik",
                name: "Traefik",
                category: "loadbalancer",
                port: 8083,
                url: "http://192.168.30.98:8083",
                description: "Reverse proxy and routing",
                status: "online",
                technology: "Traefik 3.0",
                connections: ["pms-admin", "pms-guest", "pms-staff", "pms-marketplace", "pms-backend"]
            },
            {
                id: "haproxy",
                name: "HAProxy",
                category: "loadbalancer",
                port: 8404,
                url: "http://192.168.30.98:8404/stats",
                description: "Load balancer and stats",
                status: "online",
                technology: "HAProxy 2.8",
                connections: ["pms-backend"]
            },
            {
                id: "varnish",
                name: "Varnish",
                category: "loadbalancer",
                port: 8081,
                url: "http://192.168.30.98:8081",
                description: "HTTP caching layer",
                status: "online",
                technology: "Varnish 7",
                connections: ["traefik"]
            },

            // Monitoring
            {
                id: "prometheus",
                name: "Prometheus",
                category: "monitoring",
                port: 9090,
                url: "http://192.168.30.98:9090",
                description: "Metrics collection",
                status: "online",
                technology: "Prometheus 2.47",
                connections: ["node-exporter"]
            },
            {
                id: "grafana",
                name: "Grafana",
                category: "monitoring",
                port: 3000,
                url: "http://192.168.30.98:3000",
                description: "Monitoring dashboards",
                status: "online",
                technology: "Grafana 10",
                connections: ["prometheus"]
            },
            {
                id: "node-exporter",
                name: "Node Exporter",
                category: "monitoring",
                port: 9100,
                url: "http://192.168.30.98:9100",
                description: "System metrics",
                status: "online",
                technology: "Node Exporter",
                connections: []
            },

            // CI/CD Pipeline
            {
                id: "jenkins",
                name: "Jenkins",
                category: "cicd",
                port: 8090,
                url: "http://192.168.30.98:8090",
                description: "Continuous integration",
                status: "online",
                technology: "Jenkins 2.426",
                connections: ["gitea", "sonarqube"]
            },
            {
                id: "gitea",
                name: "Gitea",
                category: "cicd",
                port: 3001,
                url: "http://192.168.30.98:3001",
                description: "Git repository management",
                status: "online",
                technology: "Gitea 1.20",
                connections: []
            },
            {
                id: "sonarqube",
                name: "SonarQube",
                category: "cicd",
                port: 9000,
                url: "http://192.168.30.98:9000",
                description: "Code quality analysis",
                status: "online",
                technology: "SonarQube 10",
                connections: ["postgresql"]
            },

            // Infrastructure
            {
                id: "coolify",
                name: "Coolify",
                category: "infrastructure",
                port: 8000,
                url: "http://192.168.30.98:8000",
                description: "Application deployment platform",
                status: "online",
                technology: "Coolify 4",
                connections: ["postgresql", "redis"]
            },
            {
                id: "portainer",
                name: "Portainer",
                category: "infrastructure",
                port: 9001,
                url: "http://192.168.30.98:9001",
                description: "Container management UI",
                status: "online",
                technology: "Portainer CE",
                connections: []
            },
            {
                id: "vault",
                name: "HashiCorp Vault",
                category: "infrastructure",
                port: 8200,
                url: "http://192.168.30.98:8200",
                description: "Secrets management",
                status: "online",
                technology: "Vault 1.15",
                connections: []
            },
            {
                id: "minio",
                name: "MinIO",
                category: "infrastructure",
                port: 9003,
                url: "http://192.168.30.98:9003",
                description: "S3-compatible object storage",
                status: "online",
                technology: "MinIO",
                connections: []
            },
            {
                id: "rabbitmq",
                name: "RabbitMQ",
                category: "infrastructure",
                port: 15672,
                url: "http://192.168.30.98:15672",
                description: "Message broker",
                status: "online",
                technology: "RabbitMQ 3.12",
                connections: []
            },
            {
                id: "memcached",
                name: "Memcached",
                category: "infrastructure",
                port: 11211,
                url: "memcached://192.168.30.98:11211",
                description: "Memory caching",
                status: "online",
                technology: "Memcached 1.6",
                connections: []
            },

            // Cyprus Services
            {
                id: "cyprus-compliance",
                name: "Cyprus Compliance",
                category: "cyprus",
                port: null,
                url: null,
                description: "Compliance monitoring service",
                status: "online",
                technology: "Custom Monitor",
                connections: ["pms-backend"]
            },
            {
                id: "cyprus-vat",
                name: "Cyprus VAT",
                category: "cyprus",
                port: null,
                url: null,
                description: "VAT scheduler and reporting",
                status: "online",
                technology: "Alpine Scheduler",
                connections: ["pms-backend"]
            }
        ];

        // Color scheme for categories
        const categoryColors = {
            pms: "#4CAF50",
            database: "#2196F3",
            monitoring: "#FF9800",
            cicd: "#9C27B0",
            loadbalancer: "#F44336",
            infrastructure: "#607D8B",
            cyprus: "#795548"
        };

        // Create the network visualization
        class NetworkMap {
            constructor() {
                this.svg = d3.select("#network");
                this.tooltip = d3.select("#tooltip");
                this.width = parseInt(this.svg.style("width"));
                this.height = parseInt(this.svg.style("height"));

                this.simulation = d3.forceSimulation()
                    .force("link", d3.forceLink().id(d => d.id).distance(120))
                    .force("charge", d3.forceManyBody().strength(-300))
                    .force("center", d3.forceCenter(this.width / 2, this.height / 2))
                    .force("collision", d3.forceCollide().radius(30));

                this.init();
            }

            init() {
                // Create links from connections
                const links = [];
                services.forEach(service => {
                    service.connections.forEach(targetId => {
                        links.push({
                            source: service.id,
                            target: targetId
                        });
                    });
                });

                // Create link elements
                const link = this.svg.append("g")
                    .selectAll("line")
                    .data(links)
                    .enter().append("line")
                    .attr("class", "link");

                // Create node elements
                const node = this.svg.append("g")
                    .selectAll("g")
                    .data(services)
                    .enter().append("g")
                    .attr("class", "node")
                    .call(d3.drag()
                        .on("start", this.dragstarted.bind(this))
                        .on("drag", this.dragged.bind(this))
                        .on("end", this.dragended.bind(this)));

                // Add circles to nodes
                node.append("circle")
                    .attr("class", "node-circle")
                    .attr("r", d => this.getNodeSize(d))
                    .attr("fill", d => categoryColors[d.category])
                    .attr("stroke", d => d.status === "online" ? "#4CAF50" : "#f44336");

                // Add text labels
                node.append("text")
                    .attr("class", "node-text")
                    .attr("dy", ".35em")
                    .text(d => d.name);

                // Add event listeners
                node.on("mouseover", this.showTooltip.bind(this))
                    .on("mousemove", this.moveTooltip.bind(this))
                    .on("mouseout", this.hideTooltip.bind(this))
                    .on("click", this.highlightConnections.bind(this));

                // Start simulation
                this.simulation
                    .nodes(services)
                    .on("tick", () => {
                        link
                            .attr("x1", d => d.source.x)
                            .attr("y1", d => d.source.y)
                            .attr("x2", d => d.target.x)
                            .attr("y2", d => d.target.y);

                        node
                            .attr("transform", d => `translate(${d.x},${d.y})`);
                    });

                this.simulation.force("link").links(links);

                // Setup search
                this.setupSearch();
            }

            getNodeSize(d) {
                if (d.category === "pms") return 25;
                if (d.category === "database") return 20;
                if (d.category === "loadbalancer") return 18;
                return 15;
            }

            showTooltip(event, d) {
                const tooltip = this.tooltip;
                tooltip.style("opacity", 1);

                let content = `<h3>${d.name}</h3>`;
                content += `<div class="detail"><strong>Category:</strong> ${d.category}</div>`;
                content += `<div class="detail"><strong>Technology:</strong> ${d.technology}</div>`;
                content += `<div class="detail"><strong>Description:</strong> ${d.description}</div>`;

                if (d.port) {
                    content += `<div class="detail"><strong>Port:</strong> ${d.port}</div>`;
                }

                if (d.url) {
                    content += `<div class="detail"><strong>URL:</strong> <a href="${d.url}" target="_blank" style="color: #4CAF50;">${d.url}</a></div>`;
                }

                content += `<div class="detail"><strong>Status:</strong> <span class="status-${d.status}">${d.status.toUpperCase()}</span></div>`;

                if (d.connections.length > 0) {
                    content += `<div class="detail"><strong>Connections:</strong> ${d.connections.length}</div>`;
                }

                tooltip.html(content);
            }

            moveTooltip(event) {
                this.tooltip
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 10) + "px");
            }

            hideTooltip() {
                this.tooltip.style("opacity", 0);
            }

            highlightConnections(event, d) {
                // Reset all highlights
                this.svg.selectAll(".node-circle").classed("node-highlight", false);
                this.svg.selectAll(".link").classed("link-active", false);

                // Highlight selected node
                d3.select(event.currentTarget).select(".node-circle").classed("node-highlight", true);

                // Highlight connected nodes and links
                this.svg.selectAll(".link")
                    .classed("link-active", link =>
                        (link.source.id === d.id || link.target.id === d.id));

                this.svg.selectAll(".node-circle")
                    .classed("node-highlight", node =>
                        d.connections.includes(node.id) || node.id === d.id);
            }

            setupSearch() {
                const searchBox = d3.select("#searchBox");
                searchBox.on("input", () => {
                    const query = searchBox.property("value").toLowerCase();

                    this.svg.selectAll(".node")
                        .style("opacity", d => {
                            if (!query) return 1;
                            return d.name.toLowerCase().includes(query) ||
                                   d.description.toLowerCase().includes(query) ||
                                   d.technology.toLowerCase().includes(query) ? 1 : 0.3;
                        });
                });
            }

            dragstarted(event, d) {
                if (!event.active) this.simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            dragended(event, d) {
                if (!event.active) this.simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }

        // Initialize the network map
        const networkMap = new NetworkMap();

        // Update statistics
        const onlineCount = services.filter(s => s.status === "online").length;
        document.getElementById("totalServices").textContent = services.length;
        document.getElementById("onlineServices").textContent = onlineCount;
    </script>
</body>
</html>